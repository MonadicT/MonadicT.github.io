<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=UTF-8" http-equiv="content-type" /><meta name="description" /><meta content="emacs, Jekyll, Static" name="keywords" /><meta content="Praki Prakash" name="author" /><link href="/images/favicon.ico" rel="icon" type="image/x-icon" /><link href="/images/favicon.ico" rel="shortcut icon" type="image/x-icon" /><link href="/site-default.css" rel="stylesheet" type="text/css" /><link href="/rss-feed" rel="alternate" title="MonadicT" type="application/rss+xml" /><link href="http://MonadicT.github.io/2016/06/19/Blogging/" rel="canonical" /><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><title>Blogging with emacs and org-mode</title></head><div id="wrap"><body><div id="header"><form action="http://www.google.com/search" id="searchform" method="get"><div><input class="box" id="s" name="q" type="text" /><input name="sitesearch" type="hidden" value="http://MonadicT.github.io" /></div></form><h1><a href="/">MonadicT</a></h1></div><div id="content-wrap"><div id="content"><div id="post"><h2 class="page-title">Blogging with emacs and org-mode</h2><p>
I do most of my work in <code>emacs</code> and blogging is no
exception. But, everytime I start a blog post, I go through a small
learning curve around the tools I use. I am going to put an end to it,
once and for all :)
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Emacs setup</h2>
<div class="outline-text-2" id="text-1">
<p>
Obviously, you need <code>org-mode</code>. Version <code>8.*</code> is preferred and there
are many breaking changes from its previous versions. If you are using
a recent vintage <code>emacs</code>, <code>org-mode</code> is already bundled. Unless you
are running into a bug involving advanced usage, there should be no
need to upgrade <code>org-mode</code>. But, I do recommend cloning repo
<code>org-mode</code> and installing it from the source. It's really fun to
experience how smooth building it is compared to some of our internal
software!
</p>

<p>
We need to tell <code>org-mode</code> what source languages to process for export
and whether it should prompt before processing a source block written
in some language. We do that by customizing <code>org-babel-load-langauges</code>
variable. We redefine <code>org-confirm-babel-evaluate</code> to skip asking for
confirmation for the languages.
</p>

<p>
We also set <code>org-src-fontify-natively</code> so that the source blocks are
fontified as well.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #008787; font-weight: bold; font-style: italic;">;; </span><span style="color: #008787; font-weight: bold; font-style: italic;">Load org export extensions</span>
(<span style="color: #ff5f00; font-weight: bold;">require</span> '<span style="font-weight: bold; text-decoration: underline;">ox-latex</span>)

<span style="color: #008787; font-weight: bold; font-style: italic;">;; </span><span style="color: #008787; font-weight: bold; font-style: italic;">org-mode should process these languages</span>
(org-babel-do-load-languages
 'org-babel-load-languages
 '((emacs-lisp . t)
   (python . t)
   (clojure . t)
   (latex . t)))

<span style="color: #008787; font-weight: bold; font-style: italic;">;; </span><span style="color: #008787; font-weight: bold; font-style: italic;">We don't want the "confirm evaluation" prompt for these languages</span>
(<span style="color: #ff5f00; font-weight: bold;">defun</span> <span style="color: #d7af00; font-weight: bold;">my-org-confirm-babel-evaluate</span> (lang body)
  (not (<span style="color: #ff5f00; font-weight: bold;">or</span> (string= lang <span style="color: #afafff; font-style: italic;">"python"</span>)
           (string= lang <span style="color: #afafff; font-style: italic;">"emacs-lisp"</span>)
           (string= lang <span style="color: #afafff; font-style: italic;">"dot"</span>)
           (string= lang <span style="color: #afafff; font-style: italic;">"latex"</span>))))
(<span style="color: #ff5f00; font-weight: bold;">setq</span> org-confirm-babel-evaluate 'my-org-confirm-babel-evaluate)
(<span style="color: #ff5f00; font-weight: bold;">setq</span> org-src-fontify-natively t)
</pre>
</div>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">Source blocks</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Source code blocks are delimited by <code>#+BEGIN_SRC lang</code> and
<code>#+END_SRC</code>. <code>emacs</code> evaluates the source block and uses the result in
export. Source block parameters, <code>:results</code> and <code>:exports</code> are
particularly useful in this context.
</p>

<p>
<code>:results</code> can have the following options specified.
</p>

<p>
collection is either <code>value</code> or <code>output</code>. The first option instructs
  <code>org-mode</code> to capture the return value of evaluation and use it in
  exporting. The second option causes any output written to <code>STDOUT</code>
  to be used as the value of the source block.
</p>

<p>
type is one of <code>table, vector</code>, <code>list</code>, <code>scalar</code>, <code>verbatim</code> or
  <code>file</code>.  By default, result is handled as a <code>table</code> or <code>scalar</code>
  depending on the value. Results of type <code>scalar</code> or <code>verbatim</code> are
  not converted to tables. A result type of <code>file</code> points to the file
  where the result is stored and causes a file link to be inserted.
</p>

<p>
format is one of:
</p>
<ul class="org-ul">
<li><code>raw</code> results are inserted directly into the buffer
</li>
<li><code>org</code> results are enclosed in a <code>#+BEGIN_SRC org</code> block
</li>
<li><code>html</code> results are assumed to be <code>HTML</code> and enclosed in a <code>#+BEGIN_SRC html</code> block
</li>
<li><code>latex</code> results assumed to be LaTeX and are enclosed in a BEGIN<sub>LaTeX</sub> block
</li>
<li><code>code</code> result are assumed to be parsable code and are enclosed in a code block
</li>
<li><code>pp</code> result is converted to pretty-printed code and is enclosed in a code block.
</li>
<li><code>drawer</code> result is wrapped in a RESULTS drawer
</li>
</ul>

<p>
handling is one of
</p>
<ul class="org-ul">
<li><code>silent</code> results are not inserted into the buffer
</li>
<li><code>replace</code> any existing value is replaced with value
</li>
<li><code>append</code> result is appended to existing
</li>
<li><code>prepend</code> reslult is prepended to existing
</li>
</ul>

<p>
<code>:exports</code> can have one of the following values.
</p>
<ul class="org-ul">
<li><code>code</code> body of source block is inserted into the buffer
</li>
<li><code>results</code> result of source block evaluation is inserted into the buffer
</li>
<li><code>both</code> code and results are inserted into the buffer
</li>
<li><code>none</code> neither code nor results are inserted into the buffer
</li>
</ul>

<p>
Here is a Python source code block which exports code and results.
</p>

<pre class="example">
#+BEGIN_SRC python :results value :exports both
# A simple Python source block
return 42
#+END_SRC
</pre>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #008787; font-weight: bold; font-style: italic;"># </span><span style="color: #008787; font-weight: bold; font-style: italic;">A simple Python source block</span>
<span style="color: #ff5f00; font-weight: bold;">return</span> 42
</pre>
</div>

<pre class="example">
42
</pre>

<p>
Here is another Python source block whose output is captured and only the results is exported.
</p>

<pre class="example">
#+BEGIN_SRC python :results output :exports results
print "Hello, world!"
return 42
#+END_SRC
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Blog post</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Header</h3>
<div class="outline-text-3" id="text-2-1">
<p>
A blog post begins with the following.
</p>
<pre class="example">
#+TITLE: Blogging with org-mode
#+tags: emacs org-mode blogging
#+options: toc:nil num:nil tex:t LaTeX:t
</pre>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Including a \LaTeX generated figure</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Here is a \LaTeX{} block to generate an image in the exported
document. By default, the result type is <b>latex</b> and the output is
wrapped in <code>#:BEGIN_LaTeX...#:END_LaTeX</code> block. Note that there are
no temporary graphics files generated at all.
</p>

<div class="org-src-container">

<pre class="src src-latex"><span style="color: #ff5f00; font-weight: bold;">\let\earth\relax</span>
<span style="color: #ff5f00; font-weight: bold;">\input</span>{<span style="color: #afd700; font-weight: bold;">eltex1</span>}
<span style="color: #ff5f00; font-weight: bold;">\begin</span>{<span style="color: #d7af00; font-weight: bold;">figure</span>}
<span style="color: #ff5f00; font-weight: bold;">\begin</span>{<span style="color: #d7af00; font-weight: bold;">center</span>}
<span style="color: #ff5f00; font-weight: bold;">\begin</span>{<span style="color: #d7af00; font-weight: bold;">picture</span>}(40,60)(0,0)
<span style="color: #ff5f00; font-weight: bold;">\grid</span>{10}{8}
<span style="color: #ff5f00; font-weight: bold;">\end</span>{<span style="color: #d7af00; font-weight: bold;">picture</span>}
<span style="color: #ff5f00; font-weight: bold;">\end</span>{<span style="color: #d7af00; font-weight: bold;">center</span>}
<span style="color: #ff5f00; font-weight: bold;">\end</span>{<span style="color: #d7af00; font-weight: bold;">figure</span>}
</pre>
</div>

<p>
For latex source code blocks, default value of <code>:results</code> is <code>output</code>
and <code>:exports</code> is <code>results</code>.
</p>

<p>
In contrast, the following block creates
a graphic file as specified by <code>:file</code> argument. <code>:results</code> is
specified as <code>output file raw</code> which causes the output to be
interpreted as a file link. Note the use of <code>raw</code> without which the
file link will be wrapped into a latex block.
</p>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">Including a graphviz diagram</h3>
<div class="outline-text-3" id="text-2-3">
<p>
We need to have <i>graphviz</i> installed on the system. <i>emacs</i> should be
able to find <code>dot</code> command. As usual, Windows is a pain but <i>I have
become comfortably numb</i> :)
</p>

<p>
You might need to locate and copy <code>ob-dot.el</code> to a location where
<code>emacs</code> will find it.
</p>

<div class="figure">
<p><img src="dotfig.png" alt="dotfig.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Publishing</h2>
<div class="outline-text-2" id="text-3">
<p>
My blogging host is at <i>mondiact.github.io</i>. My Github user id is
<i>MonadicT</i> and the repo named
<code>https://github.com/MonadicT/MonadicT.github.io</code> is the source of
posts. Github runs a restricted version of <a href="https://jekyllrb.com">Jekyll</a> on
this repo and generates a static website which is published on
<i>github.io</i>. Unfortunately, the restricted version doesn't let us do
tags and a blog post without tags is not all that useful.
</p>

<p>
The workaround is to do all the processing locally and generate the
static website and push it to github. And, we tell github to not run
Jekyll on our repo. The presence of <code>.nojekyll</code> in the root directory
tells github to run Jekyll.
</p>

<p>
All we need is a way to generate the posts locally and make it
available. While it can be done with Jekyll running on our system, I
chose to use a tool called <a href="http://nakkaya.com/static.html">Static</a> implemented in Clojure. The
following bash command starts static and rebuilds the site when posts
change.
</p>

<div class="org-src-container">

<pre class="src src-bash">java -jar ../static/target/static-app.jar --watch
</pre>
</div>


<p>
When the post is complete, we need to commit all the files to git and push it to Github.
</p>
<div class="org-src-container">

<pre class="src src-bash">git status
git add &lt;new posts&gt;
git commit -am "Commit message"
git push
</pre>
</div>

<p>
Just like that, the new post appears on Github in all its glory.
</p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Troubleshooting</h2>
<div class="outline-text-2" id="text-4">
<p>
There are many moving parts in <code>org-mode</code> and when things go wrong,
debugging is taxing. Google is our friend and one particularly nasty
bug I hit was the messed up state of <code>org-mode</code>. This magical sequence,
<code>C-U M-x org-reload</code>, fixed my issue with "wrong type argument" error.
</p>
</div>
</div>
<div class="post-tags">Tags: <a href="/tags/#emacs,">emacs, </a><a href="/tags/#Jekyll,">Jekyll, </a><a href="/tags/#Static">Static </a></div></div><div id="related"><h3 class="random-posts">Random Posts</h3><ul class="posts"><li><span>25 Feb 2014</span><a href="/2014/02/25/Ubuntu-Network_trouble/">How to fix Wi-Fi connection issues in Ubuntu 13.04</a></li><li><span>08 Mar 2014</span><a href="/2014/03/08/safeguarding-secrets-with-gnupg/">Safeguarding Secrets with GnuPG</a></li><li><span>26 Feb 2014</span><a href="/2014/02/26/JavaForkJoin/">Java Fork/Join Framework - an exemplar of elegant design</a></li><li><span>27 Nov 2016</span><a href="/2016/11/27/ParsecParser/">Writing a parser using Parsec</a></li><li><span>23 Feb 2014</span><a href="/2014/02/23/rate-limited-fns/">core.async for throttling a Clojure function</a></li></ul></div></div><div id="sidebar"><div style="border-bottom: solid 1px #ddd">PRAKI PRAKASH</div><div><img src="/images/praki-outline.png" style="float:left;padding:
                                                .5em" />I'm just an ordinary bloke! I like building things, real as well
     as imaginary. Check my instagram link below for my non-technical
     stuff.<span style="visibility: hidden">Maker, programmer, culinarian, but not necessarily in
      that order! Toiled at VMware, Yahoo, Westbridge and
      Arzoo. Recovering Java programmer, functional
      programming ideologue and Clojure practitioner. Maker of
      very thin wood shavings using antique hand
      tools. Inventor of delectable culinary chef d'œuvre!</span></div><div style="padding-top: 1em; padding-bottom:1em"><a href="//github.com/MonadicT" style="text-decoration:none;" target="_top"><img alt="Github" src="/images/GitHub-Mark-32px.png" style="border:0;width:16px;height:16px;" title="GitHub" /></a>&nbsp;&nbsp;<a href="//plus.google.com/106671634457466903954?prsrc=3" rel="publisher" style="text-decoration:none;" target="_top"><img alt="Google+" src="//ssl.gstatic.com/images/icons/gplus-32.png" style="border:0;width:16px;height:16px;" title="Google+" /></a>&nbsp;&nbsp;<a href="https://twitter.com/MonadicT"><img alt="Twitter" src="/images/Twitter_logo_blue.png" style="border:0;width:16px;height:16PX" title="Twitter" /></a><a class="ig-b- ig-b-24" href="https://www.instagram.com/fgx3prak/?ref=badge"><img alt="Instagram" height="16px" src="//badges.instagram.com/static/images/ig-badge-16.png" style="padding-left:4px;width:16px;height:16px" width="16px" /></a><a href="/rss-feed" id="rss-feed"><img height="16px" src="/images/rss.png" width="16px" /></a></div><a class="twitter-timeline" data-widget-id="438551614102577152" href="https://twitter.com/MonadicT/favorites">Favorite Tweets by @MonadicT</a><script type="text/javascript">function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','twitter-wjs');</script></div></div><div id="footer"><p>&copy; 2013-2016<a href="http://MonadicT.github.io"> Praki Prakash</a></p></div></body></div></html>