<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=UTF-8" http-equiv="content-type" /><meta name="description" /><meta content="clojure, programming, algorithm" name="keywords" /><meta content="Praki Prakash" name="author" /><link href="/images/favicon.ico" rel="icon" type="image/x-icon" /><link href="/images/favicon.ico" rel="shortcut icon" type="image/x-icon" /><link href="/default.css" rel="stylesheet" type="text/css" /><link href="/rss-feed" rel="alternate" title="MonadicT" type="application/rss+xml" /><link href="http://MonadicT.github.io/2014/02/23/rate-limited-fns/" rel="canonical" /><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><title>core.async for throttling a Clojure function</title></head><div id="wrap"><body><div id="header"><form action="http://www.google.com/search" id="searchform" method="get"><div><input class="box" id="s" name="q" type="text" /><input name="sitesearch" type="hidden" value="http://MonadicT.github.io" /></div></form><h1><a href="/">MonadicT</a></h1></div><div id="content-wrap"><div id="content"><div id="post"><h2 class="page-title">core.async for throttling a Clojure function</h2><h3>Introduction</h3><p>Most of the time, we want our functions to execute as fast as possible. But sometimes, that is not quite what is desirable. For example, if we are interfacing to an external service, we may be expected to be a friendly user of it and not bombard it with requests. While it's reasonable to expect that the service will have its own throttling mechanism, it's still a technique worth knowing.</p><p>Throttling or rate limiting is widely used in network traffic management. <a href="https://en.wikipedia.org/wiki/Token_bucket">Token bucket</a> and <a href="https://en.wikipedia.org/wiki/Leaky_bucket">Leaky bucket</a> are two commonly used algorithms. We will implement a token-based rate limiter using <em>core.async</em>.</p><p>What follows is a simple Clojure macro which defines a self-governing function.</p><h3>How it works</h3><p>The function waits for a token before proceeding and the token is only issued at the specified intervals. The waiting and token granting logic is based on <em>core.async</em> channel constructs. Each throttled function has an associated channel on which it waits to get a token. A token granter waits for an interval of time on a <em>timeout</em> channel and sends the token on the token channel. This ensures that the function will never execute more frequently than the desired interval. The <em>rendezvous</em> model used by <em>core.async</em> channels ensures that the token granter waits until a prior granted token is consumed.</p><p>Note that the body of the function is wrapped in an anonymous function within the generated wrapper function and invoked with an <em>apply</em>.</p><h3>defn-throttled</h3><p>Clojure code for implementing a throttled function. <em>defn-throttled</em> is a macro resembling Clojure's <em>defn</em> but with an additional interval specifier preceding the argument vector.</p>
<script src="https://gist.github.com/MonadicT/9182004.js">
</script><div class="post-tags">Tags: <a href="/tags/#clojure,">clojure, </a><a href="/tags/#programming,">programming, </a><a href="/tags/#algorithm">algorithm </a></div></div><div id="related"><h3 class="random-posts">Random Posts</h3><ul class="posts"><li><span>20 May 2015</span><a href="/2015/05/20/xmonad/">Configuring xmonad</a></li><li><span>25 Feb 2014</span><a href="/2014/02/25/Ubuntu-Network_trouble/">How to fix Wi-Fi connection issues in Ubuntu 13.04</a></li><li><span>24 Jan 2014</span><a href="/2014/01/24/Java-References/">Java Reference Objects</a></li><li><span>19 Jun 2016</span><a href="/2016/06/19/Blogging/">Blogging with emacs and org-mode</a></li><li><span>26 Feb 2014</span><a href="/2014/02/26/JavaForkJoin/">Java Fork/Join Framework - an exemplar of elegant design</a></li></ul></div></div><div id="sidebar"><div style="border-bottom: solid 1px #ddd">PRAKI PRAKASH</div><div><img src="/images/praki-outline.png" style="float:left;padding:
                                                .5em" />I'm just an ordinary bloke! I like building things, real as well
     as imaginary. Check my instagram link below for my non-technical
     stuff.<span style="visibility: hidden">Maker, programmer, culinarian, but not necessarily in
      that order! Toiled at VMware, Yahoo, Westbridge and
      Arzoo. Recovering Java programmer, functional
      programming ideologue and Clojure practitioner. Maker of
      very thin wood shavings using antique hand
      tools. Inventor of delectable culinary chef d'Å“uvre!</span></div><div style="padding-top: 1em; padding-bottom:1em"><a href="//github.com/MonadicT" style="text-decoration:none;" target="_top"><img alt="Github" src="/images/GitHub-Mark-32px.png" style="border:0;width:16px;height:16px;" title="GitHub" /></a>&nbsp;&nbsp;<a href="//plus.google.com/106671634457466903954?prsrc=3" rel="publisher" style="text-decoration:none;" target="_top"><img alt="Google+" src="//ssl.gstatic.com/images/icons/gplus-32.png" style="border:0;width:16px;height:16px;" title="Google+" /></a>&nbsp;&nbsp;<a href="https://twitter.com/MonadicT"><img alt="Twitter" src="/images/Twitter_logo_blue.png" style="border:0;width:16px;height:16px" title="Twitter" /></a><a class="ig-b- ig-b-24" href="https://www.instagram.com/fgx3prak/?ref=badge"><img alt="Instagram" height="16px" src="//badges.instagram.com/static/images/ig-badge-16.png" style="padding-left:4px;width:16px;height:16px" width="16px" /></a><a href="/rss-feed" id="rss-feed"><img height="16px" src="/images/rss.png" width="16px" /></a></div><a class="twitter-timeline" data-widget-id="438551614102577152" href="https://twitter.com/MonadicT/favorites">Favorite Tweets by @MonadicT</a><script type="text/javascript">function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','twitter-wjs');</script></div></div><div id="footer"><p>&copy; 2013-2015<a href="http://MonadicT.github.io"> Praki Prakash</a></p></div></body></div></html>