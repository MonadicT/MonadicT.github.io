<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=UTF-8" http-equiv="content-type" /><meta name="description" /><meta content="linux ssh tip" name="keywords" /><meta content="Nurullah Akkaya" name="author" /><link href="/images/favicon.ico" rel="icon" type="image/x-icon" /><link href="/images/favicon.ico" rel="shortcut icon" type="image/x-icon" /><link href="/default.css" rel="stylesheet" type="text/css" /><link href="/rss-feed" rel="alternate" title="MonadicT" type="application/rss+xml" /><link href="http://foo.com/2014/3/01/ssh-tips/" rel="canonical" /><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><title>SSH tips</title></head><body><div id="wrap"><div id="header"><h1><a href="/">MonadicT</a></h1></div><div id="content"><div id="post"><h2 class="page-title">SSH tips</h2><p>This is an introduction to <code>ssh</code> and its cousins <code>scp</code> and <code>sftp</code>. My goal is to show how to use this near-universal facility conveniently.</p><p><code>ssh</code> is a <em>Secure Socket Layer</em> application. You can think of <code>SSL</code> as a telephone line immune to eavesdropping by others. Only you and the person on the other end of the line can hear the conversation.</p><p>While SSL guarantees privacy between the communicating parties, there is no promise of identity. The parties don't know who they are really talking to. Identity must be guaranteed by a trusted third-party. Without getting into the details, this is what a <em>Certificate Authority</em> such as RSA and VeriSign guarantee. When you view a website, such as https://google.com, in your browser, the browser verifies the identity of the site you are connecting to and indicates that the identity of the website has been verified. If the verification didn't succeed, browsers alert the user of the problem.</p><p>When no third-party is available for identity management, the two parties must establish trust out of band. Since SSL certificates issued by CAs are expensive, most in-house usage of SSL involves <em>self-signed</em> certificates. A <em>self-signed</em> certificate has establishes an association between a name and a <em>cryptographic credentials</em> also known as <em>keys</em>. <em>keys</em> have many magical properties and one of them is that they can't be forged. But just like the key to your house door, they should be safeguarded from thieves.</p><h1>Uses of ssh</h1><p>The most common use of <code>ssh</code> is interacting with remote servers. However, <code>ssh</code> is a highly flexible command and can do a lot more than just allow you to connect to a remote server.</p><h2>Remote server connection</h2><p>In this usage, you can think of <em>ssh</em> as a secure analogue of <em>sh</em> or <em>bash</em>, the program which reads your commands, executes them and displays the output on the terminal or screen. You connect to a remote server using a command as shown below.</p><p><code>
ssh userid@remote-server
</code></p><p>When you execute this command, <em>ssh</em> authenticates you and then</p><p>When you execute <code>ssh server.foo</code>, <em>ssh</em> carries out these actions. Be warned that you may see a slightly different behavior depending on how things are configured.</p>
<ul>
  <li><code>ssh</code> client connects to the default SSL port (22) on <code>server.foo</code></li>
  <li>The remote <code>ssh</code> server accepts the connection and conveys its identity and other information to the client</li>
  <li>If the client is connecting to the server for the very first time, and the certificate is self-signed, it displays the unique fingerprint of the server's keys and asks if the connection should be made. If you choose to continue, the server's identity is added to <em>known_hosts</em> file. This is where you are expected to verify the fingerprint detected by <em>ssh</em> client with what you have established out of band.</li>
</ul><p>When you are in a secure environment (is it possible?), you can probably accept any key presented by the server.</p><p>You may see the scary "Man in the middle attack" message from <em>ssh</em>. If a server whose identity has been stored in <em>known_hosts</em> starts using a new key, <em>ssh</em> will detect it and flag it as a warning. The remedy is to ensure that the server is indeed using a new key and remove the old identity from <em>known_hosts</em>.</p><p>That is a superficial explanation of identity management of <em>ssh</em> servers.</p><h3>SSH config file To use <code>ssh</code> and its</h3><p>cousins, the command line goes something like this.</p><p>'''sh ssh [options] user@host [command] '''</p><p>/ssh/ has a very convenient facility to eliminate much typing, In =~/.ssh/config= file, you can define aliases. Here is an example entry in that file.</p><p>'''sh Host apollo 192.168.1.66  User alice '''</p><p>Now I can simply type, =ssh apollo= and it is equivalent to typing "ssh alice@apollo". The value of this in being able to provide additional options, logging as different users and being able to forget actual IP addresses or host names. This also works with =scp= and =sftp= of course.</p><h3>Password-less Remote shell access with SSH</h3><p>First we generate a RSA key pair on the local system.</p><p>'''sh ssh-keygen -t rsa '''</p><p>It's highly recommended to protect your keys with a passphrase. =ssh-keygen= saves the keys as =id_rsa= and and =id_rsa.pub=. Next we copy the public key =id_rsa.pub= to the remote system(s) using scp.</p><p>'''sh scp ~/.ssh/id_rsa.pub user@remote-ip: '''</p><p>Then we login to the remote system and append =id_rsa.pub= to =~/.ssh/authorized_keys2=.</p><p>'''sh cat ~/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys2 chmod 700 ~/.ssh/authorized_keys2 '''</p><p>It's very important to set file mode to =700=. Most =sshd= will refuse to trust =authorized_keys2= if that file is accessible by others. Now log out of the remote and try =ssh user@remote-ip=. You should be prompted for the passphrase after which you should be logged into the remote system with no password!</p><p>Now it may not work as well as blogged here. Fortunately, =ssh= has =-v= switch to help. You can see the inner workings of ssh client and figure out what is wrong. Note that repeating this option, =-vv= will show even more information.</p><p>The most common reason this doesn't work is the file permission on =~/.ssh/authorized_keys2= and naming the file =~/.ssh/authorized_keys= or =~/.ssh/authorized_keys2=.</p><h3>Using ssh from scripts</h3><p>It's is always a good idea to protect keys with pass phrases. However, this poses difficulties when you need to invoke =ssh= in scripts. =ssh-agent= is the solution to being able to use keys protected with pass phrase.</p><p>You run 'ssh-agent' and 'ssh-add'. The latter prompts for the pass phrase of your protected key. If you attempt to run any command which needs the key, the command can check =ssh-agent= and obtain the key. So, your pass phrase is safe and keys are accessible from scripts or programs.</p><p><code>ssh-agent</code> can be accessed by remote <code>ssh</code> connections (unless disabled explicitly). What this means is that you can maintain your private key on a single machine and still use that identity everywhere on the network. Private keys never leave the system on which they reside. <code>ssh-agent</code> performs operations which require the private key and sends the result to the remote connection.</p><p>These programs have many other options to address other needs. /man/ pages are your friend.</p><div class="post-tags">Tags: <a href="/tags/#linux">linux </a><a href="/tags/#ssh">ssh </a><a href="/tags/#tip">tip </a></div></div><div id="related"><h3 class="random-posts">Random Posts</h3><ul class="posts"><li><span>26 Feb 2014</span><a href="/2014/02/26/JavaForkJoin/">Java Fork/Join Framework - an exemplar of elegant design</a></li><li><span>25 Feb 2014</span><a href="/2014/02/25/Ubuntu-Network_trouble/">How to fix Wi-Fi connection issues in Ubuntu 13.04</a></li><li><span>24 Jan 2014</span><a href="/2014/01/24/Java-References/">Java Reference Objects</a></li><li><span>23 Feb 2014</span><a href="/2014/02/23/rate-limited-fns/">core.async for throttling a Clojure function</a></li><li><span>01 Mar 2014</span><a href="/2014/3/01/ssh-tips/">SSH tips</a></li></ul></div></div><div id="footer"><a href="/rss-feed"> RSS Feed</a><p>&copy; 2013<a href="http://foo.com"> Foo Bar</a></p></div></div><script type="text/javascript">
//<![CDATA[
(function() {
	     var links = document.getElementsByTagName('a');
	     var query = '?';
	     for(var i = 0; i < links.length; i++) {
		     if(links[i].href.indexOf('#disqus_thread') >= 0) {
								       query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
								       }
		     }
	     document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/nakkaya/get_num_replies.js' + query + '"></' + 'script>');
	     })();
//]]>
</script></body></html>