<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
    <title>core.async for throttling a Clojure function</title>
    <link rel="stylesheet" type="text/css"
          href="/css/poststyle.css" />
    <link href="/css/syntax.css" rel="stylesheet"/>
    <link href="/css/site.css" rel="stylesheet"/>
  </head>
  <body>
    <div id="site">
      <header>
        <nav>
          <ul id="site-nav">
            <li><a href="/index.html">Home</a>
          </ul>
        </nav>
      </header>
      <div id="site-main">
        <div id="site-content">
          <div id="post" class="post">
  <div class="share">
    <div class="g-plusone" data-size="tall" data-annotation="none" data-url="http://MonadicT.github.io/rate-limited-fns"></div>
    <script type="text/javascript">
      (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/platform.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
    </script>

    <a href="https://twitter.com/share"
       class="twitter-share-button" data-url="http://MonadicT.github.io" data-text="core.async for throttling a Clojure function" data-via="MonadicT" data-size="large" data-count="none">Tweet</a>
    <script>!function(d,s,id){var
js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,
'script', 'twitter-wjs');
    </script>
  </div>

  <div class="post-title">core.async for throttling a Clojure function</div>
  <div class="post-date">February 23, 2014</div>
  <h3 id="introduction">Introduction</h3>

<p>Most of the time, we want our functions to execute as fast as possible. But sometimes, that is not quite what is desirable. For example, if we are interfacing to an external service, we may be expected to be a friendly user of it and not bombard it with requests. While it’s reasonable to expect that the service will have its own throttling mechanism, it’s still a technique worth knowing.</p>

<p>Throttling or rate limiting is widely used in network traffic management. <a href="https://en.wikipedia.org/wiki/Token_bucket">Token bucket</a> and <a href="https://en.wikipedia.org/wiki/Leaky_bucket">Leaky bucket</a> are two commonly used algorithms. We will implement a token-based rate limiter using <em>core.async</em>.</p>

<p>What follows is a simple Clojure macro which defines a self-governing function.</p>

<h3 id="how_it_works">How it works</h3>

<p>The function waits for a token before proceeding and the token is only issued at the specified intervals. The waiting and token granting logic is based on <em>core.async</em> channel constructs. Each throttled function has an associated channel on which it waits to get a token. A token granter waits for an interval of time on a <em>timeout</em> channel and sends the token on the token channel. This ensures that the function will never execute more frequently than the desired interval. The <em>rendezvous</em> model used by <em>core.async</em> channels ensures that the token granter waits until a prior granted token is consumed.</p>

<p>Note that the body of the function is wrapped in an anonymous function within the generated wrapper function and invoked with an <em>apply</em>.</p>

<h3 id="defnthrottled">defn-throttled</h3>

<p>Clojure code for implementing a throttled function. <em>defn-throttled</em> is a macro resembling Clojure’s <em>defn</em> but with an additional interval specifier preceding the argument vector.</p>
<script src='https://gist.github.com/9182004.js'><![CDATA[ ]]></script>

  Tags:
  
    <a href="/tag/Clojure,">Clojure,</a>
  
    <a href="/tag/Code,">Code,</a>
  
    <a href="/tag/Algorithm">Algorithm</a>
  

  <div id="related">
    <h2>Related Posts</h2>
    <ul class="posts">
      
      <li><span>26 Feb 2014</span> &raquo; <a href="/JavaForkJoin">Java Fork/Join Framework - an exemplar of elegant design</a></li>
      
      <li><span>25 Feb 2014</span> &raquo; <a href="/Ubuntu-Network_trouble">How to fix Wi-Fi connection issues in Ubuntu 13.04</a></li>
      
      <li><span>24 Jan 2014</span> &raquo; <a href="/Java-References">Java Reference Objects</a></li>
      
    </ul>
  </div>
</div>

        </div>
        <div id="site-sidebar">
          <div style="border-bottom: solid 1px #ddd">
          PRAKI PRAKASH
          </div>
          <div>
            <img src="/images/praki.jpg" style="float:left;padding:
                                                .5em">
              Maker, programmer, culinarian, but not necessarily in
              that order! Toiled at VMware, Yahoo, Westbridge and
              Arzoo. Recovering Java programmer, functional
              programming ideologue and Clojure practitioner. Maker of
              very thin wood shavings using antique hand
              tools. Inventor of delectable culinary chef d'œuvre!
          </div>
          <div style="padding-top: 1em; padding-bottom:1em">
            <a href="//github.com/MonadicT"
               target="_top" style="text-decoration:none;">
              <img src="/images/GitHub-Mark-32px.png"
                   alt="Github" title="GitHub"
                   style="border:0;width:16px;height:16px;"/>
            </a>
            <a href="//plus.google.com/106671634457466903954?prsrc=3"
               rel="publisher" target="_top" style="text-decoration:none;">
              <img src="//ssl.gstatic.com/images/icons/gplus-32.png"
                   alt="Google+" title="Google+"
              style="border:0;width:16px;height:16px;"/>
            </a>
            &nbsp;
            <a href="https://twitter.com/MonadicT">
              <img src="/images/Twitter_logo_blue.png"
                   alt="Twitter" title="Twitter"
                   style="border:0;width:16px;height:16px"/>
            </a>
          </div>

          <div id="wccc2d5eb45bfede5715870025dcbe495"></div><script
          type="text/javascript" charset="UTF-8"
          src="https://www.librarything.com/widget_get.php?userid=fgx3prak&theID=wccc2d5eb45bfede5715870025dcbe495"></script><noscript><a
          href="http://www.librarything.com/profile/fgx3prak">My Library</a> at
          <a href="http://www.librarything.com">LibraryThing</a></noscript>

        </div>
      </div>
      <footer id="site-footer">
        Copyright (C) Praki Prakash
      </footer>
    </div>
  </body>
 </html>
